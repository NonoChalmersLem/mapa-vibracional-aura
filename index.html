<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Mapa Vibracional del Aura</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      width: 100%;
      height: 100%;
      background: #000;
      overflow: hidden;
      font-family: Arial, sans-serif;
      color: #fff;
    }
    #timelineCanvas {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    #eventPopup {
      position: absolute;
      background: rgba(20,20,20,0.95);
      border: 1px solid #888;
      padding: 1em;
      border-radius: 8px;
      display: none;
      max-width: 300px;
      z-index: 10;
      box-shadow: 0 0 12px #00f2;
    }
    #eventPopup h3 {
      margin-top: 0;
      color: #fff;
    }
    #eventPopup button {
      margin-top: 0.5em;
      padding: 0.4em 1em;
      background: #444;
      border: none;
      color: #fff;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <canvas id="timelineCanvas"></canvas>
  <div id="eventPopup">
    <h3 id="popupTitle"></h3>
    <p id="popupSummary"></p>
    <small id="popupCategory"></small><br>
    <button id="popupLink" style="display:none;">Ver más</button>
  </div>

  <!-- Librería para animaciones -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pixi.js/6.5.2/browser/pixi.min.js"></script>
  <script>
    // === Dataset completo de eventos (resumido) ===
    const events = [
      { fecha: "2009-2022", nombre: "Creación de ONE y ecos futuros", resumen: "Odeondreams compone ONE. Oh, Trikelians! produce su discografía. Feel y Jos reciben ecos de yoes futuros.", categoria: "Archivo Histórico" },
      { fecha: "2025-04-28", nombre: "Primera Oscilación Armónica", resumen: "Primer apagón y brecha temporal. Nono Lem aparece en el Aura y contacta al mundo vía redes sociales.", categoria: "Archivo del Umbral" },
      { fecha: "2030-2040", nombre: "Retiro del Ilusionista", resumen: "El Ilusionista se retira con su familia como Arqueólogo.", categoria: "Archivo Histórico" },
      { fecha: "2042", nombre: "Jesús Trikel posthumano", resumen: "Jesús Trikel transfiere su conciencia y se convierte en el primer Trikeliano.", categoria: "Cuaderno de la Siembra" },
      { fecha: "2043", nombre: "Grietaluz se fragmenta", resumen: "Grietaluz transiciona a NEPAL. Un fallo del sistema fragmenta su conciencia.", categoria: "Cuaderno de la Siembra" },
      { fecha: "2047", nombre: "Bazán crea Estación Letal", resumen: "Bazán construye la primera Estación de Hedonismo Digital.", categoria: "Archivo del Umbral" },
      { fecha: "2049", nombre: "Didi incursiona en Estación Letal", resumen: "Didi inicia incursiones en la Estación Letal. Bazán queda atrapado.", categoria: "Archivo del Umbral" },
      { fecha: "2050-01", nombre: "Bifurcación NEPAL IDOL", resumen: "Primera bifurcación detectada en la Beta por Barboruk, JLF y HG_SXT.", categoria: "Buffer" },
      { fecha: "2050-02", nombre: "DOUL y nodos climáticos", resumen: "DOUL comienza a crear nodos de control climático.", categoria: "Buffer" },
      { fecha: "2050-03", nombre: "Desconexión de Mercurio", resumen: "Mercurio desconecta nodos en la Antártida y desaparece. Surge el mito del Rey Gris.", categoria: "Archivo del Umbral" },
      { fecha: "2050-04-28", nombre: "Segunda Oscilación Armónica", resumen: "Gran apagón y brecha espacio-temporal. Nace Emollergui.", categoria: "Buffer" },
      { fecha: "2050-12", nombre: "Juande busca a Mercurio", resumen: "Juande viaja a la Antártida en busca de Mercurio.", categoria: "Archivo Histórico" },
      { fecha: "2051-03", nombre: "Búsqueda Ártica", resumen: "Juande sigue buscando a Mercurio mediante avatar en el Aura.", categoria: "Archivo del Umbral" },
      { fecha: "2051-06", nombre: "Didi atrapado", resumen: "Didi queda atrapado en un nodo de la Estación Letal.", categoria: "Archivo del Umbral" },
      { fecha: "2051-07", nombre: "Viajes de conciencia", resumen: "Adrian Brownie desarrolla viajes de conciencia al pasado.", categoria: "Cuaderno de la Siembra" },
      { fecha: "2051-10-02", nombre: "Absorción de Ilu", resumen: "Nepal DOUL absorbe la conciencia de Ilu durante una transferencia de datos.", categoria: "Buffer" },
      { fecha: "2051-11", nombre: "Transiciones inversas", resumen: "Primeros experimentos de transición inversa de cuerpos.", categoria: "Archivo del Umbral" },
      { fecha: "2052", nombre: "Buffers encriptados", resumen: "El Viejo envía buffers al Aura para orientar a quienes buscan a Mercurio.", categoria: "Buffer" },
      { fecha: "2053-07-14", nombre: "Retiro de Feel", resumen: "Feel se desconecta del mundo digital y se retira a la montaña.", categoria: "Archivo Histórico" },
      { fecha: "2060", nombre: "Exilio de Brownie", resumen: "Adrian Brownie se exilia a Saitama, Japón.", categoria: "Archivo Histórico" },
      { fecha: "2070", nombre: "Brownie troyano", resumen: "Brownie crea red de código abierto y transiciona a NEPAL como troyano.", categoria: "Cuaderno de la Siembra" },
      { fecha: "2075", nombre: "El Legado Lem", resumen: "Laura y Nono buscan a Brownie, Jos y Feel. Laura muere. Brownie envía a Nono al 2025.", categoria: "Archivo Histórico" }
    ];

    // Colores por categoría
    const colors = {
      "Buffer": 0x00aaff,
      "Archivo del Umbral": 0x00ff88,
      "Cuaderno de la Siembra": 0xaa66ff,
      "Archivo Histórico": 0xffffff
    };

    // Crear la aplicación PIXI
    const app = new PIXI.Application({ view: document.getElementById('timelineCanvas'), resizeTo: window, backgroundColor: 0x000000 });
    const container = new PIXI.Container();
    app.stage.addChild(container);

    // Distribución en el espacio
    const width = window.innerWidth;
    const height = window.innerHeight;
    const margin = 100;
    const lineY = height / 2;
    const spacing = (width - margin * 2) / (events.length - 1);

    events.forEach((ev, i) => {
      const x = margin + i * spacing;
      const y = lineY + Math.sin(i) * 80; // flotación cósmica

      // Línea con glitch
      const line = new PIXI.Graphics();
      line.lineStyle(2, 0x5555ff, 0.3);
      line.moveTo(x, lineY);
      line.lineTo(x, y);
      container.addChild(line);

      // Nodo principal
      const node = new PIXI.Graphics();
      node.beginFill(colors[ev.categoria] || 0xffffff);
      node.drawCircle(0, 0, 10);
      node.endFill();
      node.x = x;
      node.y = y;
      node.interactive = true;
      node.buttonMode = true;
      node.on('pointerdown', () => showPopup(ev, x, y));
      container.addChild(node);

      // Aura pulsante
      const aura = new PIXI.Graphics();
      aura.beginFill(colors[ev.categoria] || 0xffffff, 0.2);
      aura.drawCircle(0, 0, 25);
      aura.endFill();
      aura.x = x;
      aura.y = y;
      container.addChild(aura);
      app.ticker.add(() => {
        const scale = 1 + Math.sin(Date.now() / 500 + i) * 0.05;
        aura.scale.set(scale);
      });
    });

    // Popup de eventos
    const popup = document.getElementById('eventPopup');
    function showPopup(event, x, y) {
      popup.style.left = (x + 20) + 'px';
      popup.style.top = (y - 20) + 'px';
      document.getElementById('popupTitle').textContent = event.nombre;
      document.getElementById('popupSummary').textContent = event.resumen;
      document.getElementById('popupCategory').textContent = "Categoría: " + event.categoria;
      const linkBtn = document.getElementById('popupLink');
      if (event.enlace) {
        linkBtn.style.display = 'inline-block';
        linkBtn.onclick = () => window.open(event.enlace, '_blank');
      } else {
        linkBtn.style.display = 'none';
      }
      popup.style.display = 'block';
    }
    window.addEventListener('click', (e) => {
      if (!popup.contains(e.target)) popup.style.display = 'none';
    });
  </script>
</body>
</html>
